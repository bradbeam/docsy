{{ if .Site.Params.mermaid.enable -}}
  <script
    src="{{ .Site.Params.cdn.mermaidjs.url }}"
    integrity="{{ .Site.Params.cdn.mermaidjs.checksum }}"
    crossorigin="anonymous"></script>
{{ end -}}

{{ if .Site.Params.markmap.enable -}}
<style>
.markmap > svg {
  width: 100%;
  height: 300px;
}
</style>
<script>
window.markmap = {
  autoLoader: {
      manual: true,
      onReady() {
        const { autoLoader, builtInPlugins } = window.markmap;
        autoLoader.transformPlugins = builtInPlugins.filter(plugin => plugin.name !== 'prism');
      },
  },
};
</script>
<script
  src="{{ .Site.Params.cdn.markmap.url }}"
  integrity="{{ .Site.Params.cdn.markmap.checksum }}"
  crossorigin="anonymous"></script>
{{ end -}}

{{ if .Site.Params.plantuml.enable -}}
  <script src='{{ "js/deflate.js" | relURL }}'></script>
{{ end -}}

{{ if .Site.Params.katex.enable -}}
<!-- load stylesheet and scripts for KaTeX support -->
<link
  rel="stylesheet"
  href="{{ .Site.Params.cdn.katexcss.url }}"
  integrity="{{ .Site.Params.cdn.katexcss.checksum }}"
  crossorigin="anonymous">
<!-- The loading of KaTeX is deferred to speed up page rendering -->
<script
  defer
  src="{{ .Site.Params.cdn.katexjs.url }}"
  integrity="{{ .Site.Params.cdn.katexjs.checksum }}"
  crossorigin="anonymous"></script>
<!-- check whether support of mhchem is enabled in config.toml -->
{{ if .Site.Params.katex.mhchem.enable -}}
<!-- To add support for displaying chemical equations and physical units, load the mhchem extension: -->
<script
  defer
  src="{{ .Site.Params.cdn.katex_mhchem.url }}"
  integrity="{{ .Site.Params.cdn.katex_mhchem.checksum }}"
  crossorigin="anonymous"></script>
{{ end -}}
<!-- To automatically render math in text elements, include the auto-render extension: -->
<script
defer
  src="{{ .Site.Params.cdn.katex_auto_render.url }}"
  integrity="{{ .Site.Params.cdn.katex_auto_render.checksum }}"
  crossorigin="anonymous"
    {{ printf "onload='renderMathInElement(%s, %s);'" (( .Site.Params.katex.html_dom_element | default "document.body" ) | safeJS ) ( printf "%s" ( $.Site.Params.katex.options | jsonify )) | safeHTMLAttr }}></script>
{{ end -}}

{{ $jsPopper := resources.GetRemote .Site.Params.cdn.popperjs.url -}}
{{ $jsBs := resources.Get "vendor/bootstrap/dist/js/bootstrap.js" -}}
{{ $jsBase := resources.Get "js/base.js" -}}
{{ $jsAnchor := resources.Get "js/anchor.js" -}}
{{ $jsSearch := resources.Get "js/search.js" | resources.ExecuteAsTemplate "js/search.js" .Site.Home -}}
{{ $jsMermaid := resources.Get "js/mermaid.js" | resources.ExecuteAsTemplate "js/mermaid.js" . -}}
{{ $jsMarkmap := resources.Get "js/markmap.js" | resources.ExecuteAsTemplate "js/markmap.js" . -}}
{{ $jsPlantuml := resources.Get "js/plantuml.js" | resources.ExecuteAsTemplate "js/plantuml.js" . -}}
{{ $jsDrawio := resources.Get "js/drawio.js" | resources.ExecuteAsTemplate "js/plantuml.js" . -}}
{{ if .Site.Params.offlineSearch -}}
  {{ $jsSearch = resources.Get "js/offline-search.js" -}}
{{ end -}}
{{ $js := (slice $jsPopper $jsBs $jsBase $jsAnchor $jsSearch $jsMermaid $jsPlantuml $jsMarkmap $jsDrawio) | resources.Concat "js/main.js" -}}
{{ if hugo.IsProduction -}}
  {{ $js := $js | minify | fingerprint -}}
  <script src="{{ $js.RelPermalink }}" integrity="{{ $js.Data.Integrity }}" crossorigin="anonymous"></script>
{{ else -}}
  <script src="{{ $js.RelPermalink }}"></script>
{{ end -}}

{{ if .Site.Params.prism_syntax_highlighting -}}
  <script src='{{ "js/prism.js" | relURL }}'></script>
{{ end -}}

<script src='{{ "js/tabpane-persist.js" | relURL }}'></script>

{{ partial "hooks/body-end.html" . -}}
